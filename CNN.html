<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Convolution</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <link href="cnn.css" rel="stylesheet">

</head>
<body>
<header data-bs-theme="dark">
  <nav class="navbar navbar-expand-lg navbar-custom">
    <div class="container-fluid">
      <a class="navbar-brand" id="vijay" href="#">Vijay Muppalla</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav">
          <li class="nav-item"><a class="nav-link" id="home" href="#">Home</a></li>
          <li class="nav-item"><a class="nav-link active" aria-current="page" href="#">Convolution Tool</a></li>
        </ul>
      </div>
    </div>
  </nav>
</header>
<main>
  <div class="banner p-0 mb-4">
    <div class="container-fluid py-1">
      <h1 class="dispaly-5 fw-bold pageheader">Image Convolution Tool</h1>
    </div>
    <hr class="hr"/>
  </div>
  <div class="controls-container">
    <div class="container-fluid p-5 overflow-hidden">
      <div  class="row justify-content-center">
        <div class="col-12 col-md-4 order-2 order-md-1">
          <div>
            <div>
              <div class="freetext">
                <h5 class=>How to use:</h5>
                <ol>
                  <li>Drag and drop or select an image below that you would like to convolve. This image will be displayed below.</li>
                  <li>Enter the values of the convolution matrix OR select a preset convolution operation from the dropdown menu provided. (note: if no matrix is provided the identity will be used as default)</li>
                  <li>Enter the number of times you would like to convolve the image in the 'Number of Iterations' field. (note: entries less than 1 will result in the identity image being returned)</li>
                  <li>Click on either 'Grayscale Convolve' or 'Color Convolve'</li>
                  <li>The appropriate convolution will take place and the result will be displayed. This result image can then be saved using the 'Save Image' Button at the bottom of the page.</li>
                </ol>
              </div>
              <div class="image-container d-flex flex-column align-items-center justify-content-center">
                <label class="form-label">Select/Drag in image</label>
                <input
                        class="form-control form-control-sm form-control-file"
                        id="input-image"
                        type="file"
                />
              </div>
            </div>
          </div>
          <hr/>
        </div>


        <div class="col-12 col-md-4 order-3 order-md-2">
          <div class="container">
            <div class="card table-card">
              <div class="card-body" id="convolution-matrix">
                <h2 class="card-title text-center">Convolution Matrix</h2>
                <div class="row matrix-row justify-content-center">
                  <div class="col-md-8 matrix-col">
                    <div class="row t-row justify-content-center">
                      <div class="col t-div">
                        <input
                                type="number"
                                class="form-control"
                                id="matrix-0-0"
                        />
                      </div>
                      <div class="col t-div">
                        <input
                                type="number"
                                class="form-control"
                                id="matrix-0-1"
                        />
                      </div>
                      <div class="col t-div">
                        <input
                                type="number"
                                class="form-control"
                                id="matrix-0-2"
                        />
                      </div>
                    </div>
                    <div class="row t-row justify-content-center">
                      <div class="col t-div">
                        <input
                                type="number"
                                class="form-control"
                                id="matrix-1-0"
                        />
                      </div>
                      <div class="col t-div">
                        <input
                                type="number"
                                class="form-control"
                                id="matrix-1-1"
                        />
                      </div>
                      <div class="col t-div">
                        <input
                                type="number"
                                class="form-control"
                                id="matrix-1-2"
                        />
                      </div>
                    </div>
                    <div class="row t-row justify-content-center">
                      <div class="col t-div">
                        <input
                                type="number"
                                class="form-control"
                                id="matrix-2-0"
                        />
                      </div>
                      <div class="col t-div">
                        <input
                                type="number"
                                class="form-control"
                                id="matrix-2-1"
                        />
                      </div>
                      <div class="col t-div">
                        <input
                                type="number"
                                class="form-control"
                                id="matrix-2-2"
                        />
                      </div>
                    </div>
                  </div>
                </div>
                <br/>
                <div class="row justify-content-center">
                  <div class="col-md-10 select">
                    <!-- <label for="options">Choose an option:</label> -->
                    <select
                            class="form-select form-select-sm"
                            id="options"
                            name="options"
                            aria-label=".form-select-sm example"
                    >
                      <option disabled selected data-hidden="true">
                        Select an option
                      </option>
                      <option value="option1">Identity</option>
                      <option value="option2">Sharpen</option>
                      <option value="option3">Mean Blur</option>
                      <option value="option5">Gaussian Blur</option>
                      <option value="option4">Edge Detection</option>
                      <option value="option6">Horizontal Sobel</option>
                      <option value="option7">Vertical Sobel</option>
                    </select>
                  </div>
                </div>
              </div>
              <hr />
              <div class="card-body">
                <label for="iterations">Number of Iterations:</label>
                <input type="number" id="iterations" value="1" />
                <br />
                <br />
                <button class="btn btn-primary" id="convolve-button">
                  Grayscale Convolve
                </button>
                <button class="btn btn-primary" id="colorize">
                  Color Convolve
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <hr/>
      <div class="row justify-content-center">
        <div class="col-sm">
          <img id="uploaded-image" style="display: none" />
          <canvas id="initial-canvas"></canvas>
        </div>
        <div class="col-sm">
          <div class="output-container">
            <div id="output-canvas"></div>
          </div>
          <div class="row align-items-end">
            <div class="col"></div>
            <div class="col"></div>
          </div>
        </div>
        <div class="row justify-content-end">
          <div class="col-6">
            <br/>
            <div class="save">
              <button type="button" class="btn btn-primary" id="save-button">
                Save Image
              </button>
            </div>
          </div>
        </div>
      </div>
      <br/>
      <div class="col-12 col-md-12 order-1 order-md-3">
        <div class="card fixed-height-card">
          <div class="card-body">
            <h2 class="card-title" style="text-align: center;">How it all works</h2>
            <hr/>
            <h3>Image size Manipulation</h3>
            <p>This application is designed to accept images of varying dimensions. However, performing convolution operations on images of substantial size, utilizing JavaScript for matrix multiplication, often leads to system instability due to the extensive volume of calculations required. To mitigate this issue and ensure optimal performance, images exceeding 700 pixels in width or 800 pixels in height are automatically resized to fit within these maximum dimensions. This adjustment is crucial for maintaining the application's stability and preventing potential crashes during the convolution process. </p>
            <h3>Grayscale Convolution</h3>

            <h5>Color to Grayscale Conversion</h5>
            <p>When Grayscale Convolution is selected, the system initiates a process to convert the input image into grayscale. This conversion leverages a weighted average approach to determine the grayscale value of each pixel. Specifically, the original color pixel, characterized by its Red (R), Green (G), and Blue (B) components, undergoes a transformation. The formula for this conversion is as follows: 30% of the R value, 59% of the G value, and 11% of the B value are combined to calculate a new pixel value. This value ranges from 0 to 255, representing various shades of gray. This step ensures that the color image is accurately represented in grayscale, maintaining the perceptual quality and luminance of the original image.</p>

            <h5>Padding</h5>
            <p>To prepare the grayscale image for convolution operations, it is necessary to add padding around its borders. This technique involves surrounding the image with a layer of pixels set to a value of 0 (zero), creating an artificial black border. The primary purpose of padding is to preserve the dimensions of the image throughout the convolution process. Without padding, the convolution operation would gradually decrease the image size, as the outer rows and columns would be lost. By adding padding before each convolution, we ensure that no part of the original image is lost during processing.</p>

            <h5>Convolution</h5>
            <p>When applying convolution to a grayscale image, the convolution matrix is moved across the image pixel by pixel. At each position, the convolution operation involves element-wise multiplication of the kernel values with the corresponding grayscale values of the pixels covered by the kernel. These products are then summed up to produce a single output value. This output value replaces the central pixel value in the area covered by the kernel. The process is repeated as the kernel slides across the entire image, one pixel at a time, resulting in a transformed grayscale image.</p>

            <h5>Multiple Iterations</h5>
            <p>Once the convolution process is complete for the entire image, the system checks whether additional iterations were requested by the user. If further processing is required, the procedure is repeated using the recently convolved image as the new input. This iterative approach allows for multiple layers of convolution, each building on the last, to achieve the desired effect or analysis depth as specified by the user. This process continues until the specified number of iterations is completed, resulting in a finely processed image ready for review or further application.</p>

            <h3>Color Convolution</h3>

            <p>Applying convolution directly to an RGB image is more complex than to a grayscale image due to its multi-channel nature. The convolution operation needs to be applied independently to each of the three color channels. This means that the convolution kernel is replicated across each channel, and matrix multiplication is performed separately for the red, green, and blue channels.</p>

            <h5>Padding</h5>
            <p>Padding an RGB (Red, Green, Blue) image, which is inherently multi-channel, involves a more complex procedure. An RGB image consists of three separate color channels, each representing the intensity of red, green, or blue at each pixel. To apply padding to an RGB image, a layer of pixels must be added to each of the three channels independently, and each added pixel is set to a value of 0 in all three channels. This results in an artificial black border being added around the image in all three color dimensions.</p>

            <h5>Convolution</h5>
            <p>For each channel, the process mirrors that of the grayscale convolution: the kernel moves over the image, performs element-wise multiplication with the pixel values under the kernel, sums these products, and the resulting value replaces the central pixel value in the output image for that channel. After processing all channels separately, the final convolved image is reconstructed by combining the transformed red, green, and blue channels back into a single RGB image. These steps are all done for each iteration that is requested.</p>

          </div>
        </div>
      </div>
    </div>
  </div>
</main>
<div class="footer container-fluid pad">
  <footer class="pt-4 my-md-5 pt-md-5 freetext">
    <div class="row">
      <!-- Footer Description -->
      <div class="col-4 col-lg-3 mb-3">
        <span class="fs-5">Image Convolution</span>
        <ul class="list-unstyled small text-muted">
          <li class="mb-2 footer-text">Built by: Vijay Muppalla</li>
          <li class="mb-2 footer-text">© 2024</li>
          <li class="mb-2 footer-text"></li>
        </ul>
      </div>
      <!-- External Resources Links -->
      <div class="col-4 col-lg-2 mb-3">
        <h5>External Resources</h5>
        <ul class="list-unstyled text-small" >
          <li class="mb-1">
            <a
                    class="text-decoration-none links"
                    href="https://setosa.io/ev/image-kernels/"
                    target="_blank"
            >How Convolution Works</a
            >
          </li>
          <li class="mb-1">
            <a
                    class="text-decoration-none links"
                    href="https://mebble.github.io/imfx/spatial.html"
                    target="_blank"
            >
              Mebble Tool Demo</a
            >
          </li>
          <li class="mb-1">
            <a
                    class="text-decoration-none links"
                    href="https://github.com/mebble/imfx"
                    target="_blank"
            >
              Mebble Tool Repository
            </a>
          </li>
        </ul>
      </div>
      <!-- Contact Section -->
      <div class="col-4 col-lg-2 mb-3 freetext">
        <h5>Contact</h5>
        <a
                href="https://www.linkedin.com/in/vijay-muppalla-7a380526a/"
                target="_blank"
                class="icons p-2"
        ><span style="color: white"
        ><i class="fa-brands fa-linkedin fa-xl"></i></span
        ></a>

        <a
                href="https://github.com/Nomadz10"
                target="_blank"
                class="icons p-2"
        ><span style="color: white"
        ><i class="fa-brands fa-github fa-xl"></i></span></a
      ></a>
      </div>
    </div>
    <div class="row">
      <div class="col-4 align-self-start"></div>
      <div class="col-4 align-self-center"></div>
    </div>
  </footer>
</div>
<!-- Bootstrap JS, FontAwesome, and Custom JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
<script src="https://kit.fontawesome.com/c5b250e284.js" crossorigin="anonymous"></script>
<script>
  const matrixValues = {
    option1: [
      [0, 0, 0],
      [0, 1, 0],
      [0, 0, 0],
    ],
    option2: [
      [0, -1, 0],
      [-1, 5, -1],
      [0, -1, 0],
    ],
    option3: [
      [1 / 9, 1 / 9, 1 / 9],
      [1 / 9, 1 / 9, 1 / 9],
      [1 / 9, 1 / 9, 1 / 9],
    ],
    option4: [
      [-1, -1, -1],
      [-1, 8, -1],
      [-1, -1, -1],
    ],
    option5: [
      [1 / 16, 2 / 16, 1 / 16],
      [2 / 16, 4 / 16, 2 / 16],
      [1 / 16, 2 / 16, 1 / 16],
    ],
    option6: [
      [-1, -2, -1],
      [0, 0, 0],
      [1, 2, 1],
    ],
    option7: [
      [-1, 0, 1],
      [-2, 0, 2],
      [-1, 0, 1],
    ],
  };

  const selectElement = document.getElementById("options");
  const matrixInputs = document.querySelectorAll(
          "#convolution-matrix input"
  );

  selectElement.addEventListener("change", function () {
    const selectedOption = this.value;
    if (selectedOption in matrixValues) {
      const selectedMatrix = matrixValues[selectedOption];
      for (let i = 0; i < selectedMatrix.length; i++) {
        for (let j = 0; j < selectedMatrix[i].length; j++) {
          const inputElement = document.getElementById(`matrix-${i}-${j}`);
          inputElement.value = selectedMatrix[i][j];
        }
      }
    } else {
      for (let i = 0; i < matrixInputs.length; i++) {
        matrixInputs[i].value = "";
      }
    }
  });

  const iterationsInput = document.getElementById("iterations");
  const greyconvolve = document.getElementById("convolve-button");
  const initialCanvas = document.getElementById("initial-canvas");
  const colorconvolve = document.getElementById("colorize")
  let inputImageData;

  function convertToGrayscale(imageData) {
    let grayscaleMatrix = [];
    for (let i = 0; i < imageData.height; i++) {
      grayscaleMatrix[i] = [];
      for (let j = 0; j < imageData.width; j++) {
        let index = i * 4 * imageData.width + j * 4;
        let r = imageData.data[index];
        let g = imageData.data[index + 1];
        let b = imageData.data[index + 2];
        grayscaleMatrix[i][j] = 0.3 * r + 0.59 * g + 0.11 * b;
      }
    }
    return grayscaleMatrix;
  }

  function convolution2D(largeMatrix, smallMatrix) {
    let result = [];
    for (let i = 0; i < largeMatrix.length - 2; i++) {
      result[i] = [];
      for (let j = 0; j < largeMatrix[i].length - 2; j++) {
        let sum = 0;
        for (let k = 0; k < 3; k++) {
          for (let l = 0; l < 3; l++) {
            sum += largeMatrix[i + k][j + l] * smallMatrix[k][l];
          }
        }
        result[i][j] = sum;
      }
    }
    return result;
  }
  function convolution3D(largeMatrix, smallMatrix) {
    let result = [];
    for (let i = 0; i < largeMatrix.length - 2; i++) {
      result[i] = [];
      for (let j = 0; j < largeMatrix[i].length - 2; j++) {
        result[i][j] = [];
        for (let z = 0; z < largeMatrix[i][j].length; z++) {
          let sum = 0;
          for (let k = 0; k < 3; k++) {
            for (let l = 0; l < 3; l++) {
              sum += largeMatrix[i + k][j + l][z] * smallMatrix[k][l];
            }
          }
          result[i][j][z] = sum;
        }
      }
    }
    return result;
  }
  const inputImage = document.getElementById("input-image");
  const canvas = document.createElement("canvas");
  const w = 695;
  const h = 800;
  inputImage.addEventListener("change", function (event) {
    let canvasDiv = document.getElementById("output-canvas");
    canvasDiv.innerHTML = "";
    let reader = new FileReader();
    reader.onload = function (event) {
      let image = new Image();
      image.onload = function () {
        initialCanvas.width = image.width;
        initialCanvas.height = image.height;
        if (initialCanvas.width > w) {
          initialCanvas.height *= w / initialCanvas.width;
          initialCanvas.width = w;
        } else {
          if (initialCanvas.height > h) {
            initialCanvas.width *= h / initialCanvas.height;
            initialCanvas.height = h;
          }
        }
        canvas.width = initialCanvas.width;
        canvas.height = initialCanvas.height;
        let context = initialCanvas.getContext("2d");
        context.drawImage(
                image,
                0,
                0,
                initialCanvas.width,
                initialCanvas.height
        );
        inputImageData = context.getImageData(
                0,
                0,
                initialCanvas.width,
                initialCanvas.height
        );
      };
      image.src = event.target.result;
    };
    reader.readAsDataURL(event.target.files[0]);
  });


  colorconvolve.addEventListener("click", function(event) {
    event.preventDefault();
    if (!inputImageData) {
      return alert("Please select an image.");
    }
    //NUMBER OF ITERATIONS
    let iterations = parseInt(iterationsInput.value);
    // Define the dimensions of the image
    const width = inputImageData.width;
    const height = inputImageData.height;

    // Create a 3D array to store the pixel data
    let finMatrix = new Array(height);

    // Iterate over each row of pixels
    for (let y = 0; y < height; y++) {
      // Create an array to store the pixels in this row
      finMatrix[y] = new Array(width);

      // Iterate over each pixel in the row
      for (let x = 0; x < width; x++) {
        // Calculate the index of the pixel in the image data array
        const index = (y * width + x) * 4; // Each pixel consists of 4 values (RGBA)

        // Extract the color channels (RGB) of the pixel
        const r = inputImageData.data[index];
        const g = inputImageData.data[index + 1];
        const b = inputImageData.data[index + 2];

        // Store the RGB values in the finMatrix
        finMatrix[y][x] = [r, g, b];
      }
    }
    //DEFAULT CONV MATRIX
    let convMatrix = [
      [-1, -1, -1],
      [-1, 2, -1],
      [-1, -1, -1],
    ];
    //GETTING THE CONVOLUTION MATRIX
    convMatrix[0][0] = parseFloat(
            document.getElementById("matrix-0-0").value
    );
    convMatrix[0][1] = parseFloat(
            document.getElementById("matrix-0-1").value
    );
    convMatrix[0][2] = parseFloat(
            document.getElementById("matrix-0-2").value
    );
    convMatrix[1][0] = parseFloat(
            document.getElementById("matrix-1-0").value
    );
    convMatrix[1][1] = parseFloat(
            document.getElementById("matrix-1-1").value
    );
    convMatrix[1][2] = parseFloat(
            document.getElementById("matrix-1-2").value
    );
    convMatrix[2][0] = parseFloat(
            document.getElementById("matrix-2-0").value
    );
    convMatrix[2][1] = parseFloat(
            document.getElementById("matrix-2-1").value
    );
    convMatrix[2][2] = parseFloat(
            document.getElementById("matrix-2-2").value
    );
    //IF EMPTY MATRIX IS ENTERED THIS GIVES IDENTITY
    if (Number.isNaN(convMatrix[0][0])) {
      convMatrix = [
        [0, 0, 0],
        [0, 1, 0],
        [0, 0, 0],
      ];
    }
    function addPadding(originalMatrix) {
      // Original dimensions
      const originalHeight = originalMatrix.length;
      const originalWidth = originalMatrix[0].length;

      // New dimensions including padding
      const paddedHeight = originalHeight + 2;
      const paddedWidth = originalWidth + 2;

      // Create a new matrix for the padded image
      let paddedMatrix = new Array(paddedHeight);

      for (let y = 0; y < paddedHeight; y++) {
        paddedMatrix[y] = new Array(paddedWidth);

        for (let x = 0; x < paddedWidth; x++) {
          // Check if the current pixel is part of the original image or the padding
          if (y > 0 && y < paddedHeight - 1 && x > 0 && x < paddedWidth - 1) {
            // This is part of the original image, so copy the pixel over
            paddedMatrix[y][x] = originalMatrix[y - 1][x - 1];
          } else {
            // This is part of the padding
            paddedMatrix[y][x] = [0, 0, 0];
          }
        }
      }

      return paddedMatrix;
    }

    //ACTUAL CONVOLUTIONS HAPPENING
    for (let i = 0; i < iterations; i++) {
      finMatrix = addPadding(finMatrix);
      finMatrix = convolution3D(finMatrix, convMatrix);
    }

// Rendering the result on canvas
    let canvas = document.createElement("canvas");
    let canvasDiv = document.getElementById("output-canvas");
    canvasDiv.innerHTML = "";
    canvas.width = finMatrix[0].length;
    canvas.height = finMatrix.length;
    canvasDiv.appendChild(canvas);

    let context = canvas.getContext("2d");
    let finImgData = context.createImageData(canvas.width, canvas.height);

    for (let y = 0; y < finMatrix.length; y++) {
      for (let x = 0; x < finMatrix[0].length; x++) {
        const index = (y * finMatrix[0].length + x) * 4;
        finImgData.data[index] = finMatrix[y][x][0]; // Red channel
        finImgData.data[index + 1] = finMatrix[y][x][1]; // Green channel
        finImgData.data[index + 2] = finMatrix[y][x][2]; // Blue channel
        finImgData.data[index + 3] = 255; // Alpha channel
      }
    }
    context.putImageData(finImgData, 0, 0);

  });


  greyconvolve.addEventListener("click", function (event) {
    event.preventDefault();
    if (!inputImageData) {
      return alert("Please select an image.");
    }

    //NUMBER OF ITERATIONS
    let iterations = parseInt(iterationsInput.value);
    //GETTING GRAYSCALED MATRIX
    let finMatrix = convertToGrayscale(inputImageData);

    //DEFAULT CONV MATRIX
    let convMatrix = [
      [-1, -1, -1],
      [-1, 2, -1],
      [-1, -1, -1],
    ];
    //GETTING THE CONVOLUTION MATRIX
    convMatrix[0][0] = parseFloat(
            document.getElementById("matrix-0-0").value
    );
    convMatrix[0][1] = parseFloat(
            document.getElementById("matrix-0-1").value
    );
    convMatrix[0][2] = parseFloat(
            document.getElementById("matrix-0-2").value
    );
    convMatrix[1][0] = parseFloat(
            document.getElementById("matrix-1-0").value
    );
    convMatrix[1][1] = parseFloat(
            document.getElementById("matrix-1-1").value
    );
    convMatrix[1][2] = parseFloat(
            document.getElementById("matrix-1-2").value
    );
    convMatrix[2][0] = parseFloat(
            document.getElementById("matrix-2-0").value
    );
    convMatrix[2][1] = parseFloat(
            document.getElementById("matrix-2-1").value
    );
    convMatrix[2][2] = parseFloat(
            document.getElementById("matrix-2-2").value
    );
    //IF EMPTY MATRIX IS ENTERED THIS GIVES IDENTITY
    if (Number.isNaN(convMatrix[0][0])) {
      convMatrix = [
        [0, 0, 0],
        [0, 1, 0],
        [0, 0, 0],
      ];
    }

    //ACTUAL CONVOLUTIONS HAPPENING
    for (let i = 0; i < iterations; i++) {
      //ADDING PADDING
      let size = finMatrix[0].length;
      const zerosArray = new Array(size).fill(0);
      finMatrix.unshift(zerosArray);
      finMatrix.push(zerosArray);
      finMatrix = finMatrix.map((row) => [0, ...row, 0]);
      finMatrix = convolution2D(finMatrix, convMatrix);
    }
    let canvas = document.createElement("canvas");
    let canvasDiv = document.getElementById("output-canvas");
    canvasDiv.innerHTML = "";
    canvas.width = finMatrix[0].length;
    canvas.height = finMatrix.length;
    canvasDiv.appendChild(canvas);

    let context = canvas.getContext("2d");
    let finImgData = context.createImageData(canvas.width, canvas.height);

    for (let y = 0; y < finMatrix.length; y++) {
      for (let x = 0; x < finMatrix[0].length; x++) {
        const index = 4 * (x + y * finMatrix[0].length);
        finImgData.data[index] = finMatrix[y][x];
        finImgData.data[index + 1] = finMatrix[y][x];
        finImgData.data[index + 2] = finMatrix[y][x];
        finImgData.data[index + 3] = 255;
      }
    }
    context.putImageData(finImgData, 0, 0);
    const saveButton = document.getElementById("save-button");
    saveButton.addEventListener("click", () => {
      const dataURL = canvas.toDataURL("image/png"); // convert canvas content to data URL
      const downloadLink = document.createElement("a"); // create a new download link
      downloadLink.href = dataURL; // set the href of the link to the data URL
      downloadLink.download = "convolutedImage.png"; // set the download filename
      document.body.appendChild(downloadLink); // append the link to the document body
      downloadLink.click(); // simulate a click on the link to trigger the download
      document.body.removeChild(downloadLink); // remove the link from the document body
    });
  });
</script>
<script
        src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
        crossorigin="anonymous"
></script>
<script
        src="https://kit.fontawesome.com/c5b250e284.js"
        crossorigin="anonymous"
></script>
<script>
  document.getElementById('home').addEventListener('click', function(e) {
    e.preventDefault(); // Prevent the default anchor behavior
    // Redirect to the Convolution Tool page
    window.location.href = './index.html'; // Update this path
  });
</script>
<script>
  document.getElementById('vijay').addEventListener('click', function(e) {
    e.preventDefault(); // Prevent the default anchor behavior
    // Redirect to the Convolution Tool page
    window.location.href = './index.html'; // Update this path
  });
</script>
<script>
  // Function to show or hide the save button based on image presence
  function updateSaveButtonVisibility() {
    const outputCanvas = document.getElementById('output-canvas');
    const saveButton = document.getElementById('save-button');
    // Check if there is a canvas inside the output-canvas div
    const hasCanvas = outputCanvas.querySelector('canvas') !== null;

    // Show or hide the save button accordingly
    if (hasCanvas) {
      saveButton.style.display = 'block';
    } else {
      saveButton.style.display = 'none';
    }
  }

  // Create a MutationObserver to watch for changes in the output-canvas div
  const observer = new MutationObserver((mutations) => {
    mutations.forEach((mutation) => {
      if (mutation.type === 'childList') {
        // When children are added or removed, update the save button visibility
        updateSaveButtonVisibility();
      }
    });
  });

  // Start observing the output-canvas div for changes
  const config = { attributes: false, childList: true, subtree: false };
  observer.observe(document.getElementById('output-canvas'), config);

  // Initial check in case the canvas is already present at script load
  updateSaveButtonVisibility();
</script>
</body>
</html>

